<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-11-10 Tue 20:07 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dumang DK6 Keyboard</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="James Ni" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../css/notes.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Dumang DK6 Keyboard</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org636bdc4">Configuration on Windows</a>
<ul>
<li><a href="#orgfb67089">Windows in VirtualBox</a></li>
</ul>
</li>
<li><a href="#orgbaf85d8">Issues and Solutions on Mac</a>
<ul>
<li><a href="#orgba79db7">[Issue-1] Common key combos not working</a>
<ul>
<li><a href="#orge34e700">Issue</a></li>
<li><a href="#org997a22c">Solution</a></li>
</ul>
</li>
<li><a href="#org7b78a29">[Issue-2] <code>Fn</code> key combos not working</a>
<ul>
<li><a href="#org07a2038">Issue</a></li>
<li><a href="#org7cb604f">Solution</a></li>
</ul>
</li>
<li><a href="#org560cc68">[Issue-3] <code>dumang-sync</code> failed to resync on system wake up and keyboard reconnecting</a>
<ul>
<li><a href="#org03f1a31">Issue</a></li>
<li><a href="#orgff202b3">Solution</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
Setup two Dumang Dk6 keyboards to work on MacOS.
</p>

<p>
Product link: <a href="http://www.beyondq.com/%E8%B6%85%E9%85%B7%E7%A7%91%E6%8A%80-%E4%BA%A7%E5%93%81-%E6%AF%92%E8%9F%92%E9%94%AE%E7%9B%98-%E6%A8%A1%E5%9D%97%E5%8C%96%E9%94%AE%E7%9B%98-dk6-dumang.html">Dumang DK6</a>
</p>

<div id="outline-container-org636bdc4" class="outline-2">
<h2 id="org636bdc4">Configuration on Windows</h2>
<div class="outline-text-2" id="text-org636bdc4">
</div>
<div id="outline-container-orgfb67089" class="outline-3">
<h3 id="orgfb67089">Windows in VirtualBox</h3>
<div class="outline-text-3" id="text-orgfb67089">
<p>
As of 20201110, the Dumang app only supports Windows. You can only configure the keyboards on Windows, either in a real machine or a virtual machine. See <a href="virtualbox.html">Windows in VirtualBox</a> for how to setup.
</p>
</div>
</div>
</div>

<div id="outline-container-orgbaf85d8" class="outline-2">
<h2 id="orgbaf85d8">Issues and Solutions on Mac</h2>
<div class="outline-text-2" id="text-orgbaf85d8">
<p>
While everything works perfectly out of box on Windows, three big problems must be solved before we could make full use of two DK6 keyboards.
</p>
</div>

<div id="outline-container-orgba79db7" class="outline-3">
<h3 id="orgba79db7">[Issue-1] Common key combos not working</h3>
<div class="outline-text-3" id="text-orgba79db7">
</div>
<div id="outline-container-orge34e700" class="outline-4">
<h4 id="orge34e700">Issue</h4>
<div class="outline-text-4" id="text-orge34e700">
<p>
Common key combos don't work if the keys of the combo are not on the same keyboard. For example, with dvorak layout, the following key combos will not work: <code>Left-Cmd</code> <code>c</code>, <code>Left-Ctrl</code> <code>d</code>, or <code>Left-Option</code> <code>r</code>, because <code>c</code> <code>d</code> <code>r</code> are all on the right.
</p>
</div>
</div>

<div id="outline-container-org997a22c" class="outline-4">
<h4 id="org997a22c">Solution</h4>
<div class="outline-text-4" id="text-org997a22c">
<p>
Install <a href="https://karabiner-elements.pqrs.org">Karabiner-elements</a> (here is the <a href="https://karabiner-elements.pqrs.org/docs/getting-started/installation/">installation instruction</a>). Once the installation and setup is done, open the app and the issue will be gone. No further configuration is required. Add the app to login item list so that you don't need to open it every time you login the system.
</p>
</div>
</div>
</div>

<div id="outline-container-org7b78a29" class="outline-3">
<h3 id="org7b78a29">[Issue-2] <code>Fn</code> key combos not working</h3>
<div class="outline-text-3" id="text-org7b78a29">
</div>
<div id="outline-container-org07a2038" class="outline-4">
<h4 id="org07a2038">Issue</h4>
<div class="outline-text-4" id="text-org07a2038">
<p>
This issue is similar to Issue-1, but instead happens to the <code>Fn</code> key. <code>Fn</code> key combos don't work if the keys of the combo are not on the same keyboard. For example, with <code>Fn</code> configured to switching to layer 1 and with dvorak layout, <code>Fn</code> <code>c</code> will not do what you have configured it to do. When you press a <code>Fn</code> key combo, the layer indicating LED is red on the <code>Fn</code> side and cyan on the <code>c</code> side which should've been red, too. (layer to LED color mapping: 0(default layer): cyan, 1: red, 2: green, 3: blue)
</p>
</div>
</div>

<div id="outline-container-org7cb604f" class="outline-4">
<h4 id="org7cb604f">Solution</h4>
<div class="outline-text-4" id="text-org7cb604f">
<p>
Install and setup <a href="https://pypi.org/project/dumang-ctrl/">Dumang-ctrl</a>. Dumang-ctrl is a runnable script written in Python 3. It syncs the events between two Dumang DK6 keyboards. For example, when you press <code>Fn</code> on one board to switch to layer 1, the other board will also be switched to layer 1.
</p>
<ol class="org-ol">
<li>Install <a href="https://brew.sh">Homebrew</a></li>
<li>Setup Python3
<ol class="org-ol">
<li><p>
Install Python3
</p>
<div class="org-src-container">
<pre class="src src-sh">brew install python <span style="color: #A8541C;"># </span><span style="color: #A8541C;">this installs python3 by default</span>
</pre>
</div></li>
<li><p>
Add python lib to <code>$PATH</code>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #A8541C;"># </span><span style="color: #A8541C;">Setting PATH for homebrew Python</span>
<span style="color: #3C5F89; font-weight: bold;">export</span> <span style="color: #232323;">PATH</span>=<span style="color: #1B9554;">"/usr/local/opt/python/libexec/bin:$PATH"</span>
</pre>
</div></li>
</ol></li>
<li><p>
Install <code>dumang-ctrl</code> and its dependencies
</p>
<div class="org-src-container">
<pre class="src src-sh">brew install libusb
pip install dumang-ctrl libusb1 libusb
</pre>
</div></li>
<li>Run <code>dumang-sync</code> in terminal</li>
<li>Press <code>Fn</code> on one keyboard, and the light on other board should now be red (layer 1).</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org560cc68" class="outline-3">
<h3 id="org560cc68">[Issue-3] <code>dumang-sync</code> failed to resync on system wake up and keyboard reconnecting</h3>
<div class="outline-text-3" id="text-org560cc68">
</div>
<div id="outline-container-org03f1a31" class="outline-4">
<h4 id="org03f1a31">Issue</h4>
<div class="outline-text-4" id="text-org03f1a31">
<p>
When you do a fresh run of <code>dumang-sync</code>, everything works fine immediately. However, whenever MacOS wakes up from sleep, or you logout and login, or if you plug out and plug in the keyboards, it failed to resync. Checking the log, the script seemed to be trying to auto detect the hot plugging, yet it just failed to resync.
</p>
</div>
</div>

<div id="outline-container-orgff202b3" class="outline-4">
<h4 id="orgff202b3">Solution</h4>
<div class="outline-text-4" id="text-orgff202b3">
<p>
Killing and restarting the daemon will solve the problem. Since sleeping and waking up from sleep happens very often, there must be a way to quickly bring the daemon back to life. But to do it manually and frequently in terminal is counter-efficient, and keeping a terminal window open all the time running the daemon is cluttered. The best way is to just press one key or key combo and the daemon would get restarted. I came up with a solution by integrating Shell script, Automator, and QuickSilver.
</p>
<ol class="org-ol">
<li><p>
Create an Automator application to run the following shell scipt to do auto killing and restarting. Save the application as <code>Dumang-Sync</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">pgrep -f dumang-sync | xargs kill
/usr/local/bin/dumang-sync &gt; /dev/null <span style="color: #1B9554;">2</span>&gt;&amp;<span style="color: #1B9554;">1</span> &amp;
</pre>
</div></li>
<li>Install <a href="https://qsapp.com">QuickSilver</a>. Add a trigger to open the app created above, and assign a shortcut to the trigger, for example, <code>Cmd+Home</code>. The key combo must not be a <code>Fn</code> combo as the daemon had already stopped working at the time. Now, you can just press <code>Cmd+Home</code> to bring the daemon back to life.</li>
<li>Auto launch <code>dumang-sync</code> on system startup. Add the <code>dumang-sync</code> app to login item list so that you don't need to open it every time you login the system, though it's just one key combo away.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
